/*! jquery.linkage-selector.min.js v1.0.0 https://cople.github.io/LinkageSelector */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):t.LinkageSelector=e(t.jQuery)}(this,function(t){"use strict";function e(s){var n=this;this.settings=t.extend({},e.defaults,s),this.settings.dataUrl?t.getJSON(this.settings.dataUrl,function(t){return n.init(t)}):this.init(this.settings.data)}return t=t&&t.hasOwnProperty("default")?t["default"]:t,e.prototype={constructor:e,convertToArrayData:function(e){function s(e){return t.map(e,function(t){var e={};return e[i.name]=t,e[i.value]=t,e})}function n(e){return t.map(e,function(e,a){var l={};return l[i.name]=a,l[i.value]=a,l[i.children]=t.isArray(e)?s(e):n(e),l})}var i=this.settings.dataKeys;return n(e)},getDepth:function(e){var s=this;return Math.max.apply(Math,t.map(e,function(t){return 1+(t[s.settings.dataKeys.children]?s.getDepth(t[s.settings.dataKeys.children]):0)}))},setStyle:function(t,e){switch(this.settings.emptyStyle){case"disabled":t.disabled=!e;break;case"hidden":t.style.display=e?"inline-block":"none"}},getValue:function(){return t.map(this.selects,function(t){return t.value})},setValue:function(t,e){this.selects[0].value=t[0],this.updateSelect.apply(this,[this.selects[1]].concat(t.slice(1))),e||this.settings.onChange.call(this,this.getValue())},resetValue:function(t){this.selects[0].selectedIndex=0,this.updateSelect(this.selects[1]),t||this.settings.onChange.call(this,this.getValue())},updateSelect:function(e,s){var n=this,i=this.$selects.index(e),a=this.selects[i-1].value,l=a&&(!this.settings.placeholder||!this.selects[i-1].options[0].selected);if(this.setStyle(e,l),this.settings.required&&(e.required=l),e.options.length=this.settings.placeholder?1:0,e.selectedIndex=e.options.length-1,l&&this.selectOptions[i-1]){var c=this.settings.dataKeys;t.each(this.selectOptions[i-1],function(l,r){if(r[c.value]===a){var h=r[c.children];return n.selectOptions[i]=h,t.each(h,function(t,s){return e.options.add(new Option(s[c.name],s[c.value]))}),s&&(e.value=s),n.setStyle(e,!!h.length),n.settings.required&&(e.required=!!h.length),!1}return!0})}i+1<this.selects.length&&this.updateSelect.apply(this,[this.selects[i+1]].concat(Array.prototype.slice.call(arguments,2)))},init:function(e){var s=this;if(this.$container=t(this.settings.container),this.container=this.$container[0],this.$selects=this.$container.find(this.settings.selector),this.selects=this.$selects.get(),this.data=t.isArray(e)?e:this.convertToArrayData(e),this.selectOptions=[this.data],!this.selects.length){for(var n=document.createDocumentFragment(),i=0,a=this.getDepth(this.data);i<a;i++){var l=document.createElement("select");this.selects.push(l),n.appendChild(l)}this.$selects=t(this.selects),this.settings.onRender.call(this,this.selects),this.container.appendChild(n)}if(this.$selects.each(function(t,e){e.options.length=0}),this.settings.placeholder){var c=this.settings.placeholder;this.$selects.each(function(t,e){var s=("string"==typeof c?c:c[t]).split("|");e.options.add(new Option(s[0],s[1],!0,!0)),e.options[0].disabled=!0})}var r=this.selects[0];r.required=this.settings.required,t.each(this.data,function(t,e){r.options.add(new Option(e[s.settings.dataKeys.name],e[s.settings.dataKeys.value]))}),this.$selects.slice(0,this.selects.length-1).each(function(e,n){t(n).on("change",function(){return s.updateSelect(s.selects[e+1])})}),this.$selects.on("change",function(){return s.settings.onChange.call(s,s.getValue())}),this.settings.defaultValue?this.setValue(this.settings.defaultValue,!0):this.$selects.slice(1).each(function(t,e){return s.setStyle(e,!1)})}},e.defaults={data:{},dataUrl:null,container:document.body,selector:"select",placeholder:"请选择",defaultValue:null,dataKeys:{name:"name",value:"code",children:"childs"},required:!0,emptyStyle:"disabled",onRender:function(){},onChange:function(){}},t.fn.linkageSelector=function(s,n){return"string"==typeof s?t.data(this[0],"LinkageSelector")[s](n):this.each(function(){t.data(this,"LinkageSelector",new e(t.extend({container:this},s)))})},t.fn.linkageSelector.defaults=e.defaults,e});

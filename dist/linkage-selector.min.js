/*! linkage-selector.min.js v1.0.0 https://cople.github.io/LinkageSelector */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.LinkageSelector=e()}(this,function(){"use strict";function t(e){var n=this;if(this.settings=Object.assign({},t.defaults,e),this.settings.dataUrl){var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&200===s.status&&n.init(JSON.parse(s.responseText))},s.open("GET",this.settings.dataUrl,!0),s.send()}else this.init(this.settings.data)}!function(){function t(t){this.value=t}function e(e){function n(r,i){try{var a=e[r](i),o=a.value;o instanceof t?Promise.resolve(o.value).then(function(t){n("next",t)},function(t){n("throw",t)}):s(a.done?"return":"normal",a.value)}catch(t){s("throw",t)}}function s(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?n(r.key,r.arg):i=null}var r,i;this._invoke=function(t,e){return new Promise(function(s,a){var o={key:t,arg:e,resolve:s,reject:a,next:null};i?i=i.next=o:(r=i=o,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var e=function(t){return Array.isArray(t)?t:Array.from(t)},n=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};return Array.from||(Array.from=function(t){return Array.prototype.slice.call(t)}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}),Object.assign||(Object.assign=function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}),t.prototype={constructor:t,convertToArrayData:function(t){function e(t){return t.map(function(t){var e={};return e[s.name]=t,e[s.value]=t,e})}function n(t){return Object.keys(t).map(function(r){var i=t[r],a={};return a[s.name]=r,a[s.value]=r,a[s.children]=Array.isArray(i)?e(i):n(i),a})}var s=this.settings.dataKeys;return n(t)},getDepth:function(t){var e=this;return Math.max.apply(Math,t.map(function(t){return 1+(t[e.settings.dataKeys.children]?e.getDepth(t[e.settings.dataKeys.children]):0)}))},setStyle:function(t,e){switch(this.settings.emptyStyle){case"disabled":t.disabled=!e;break;case"hidden":t.style.display=e?"inline-block":"none"}},getValue:function(){return this.selects.map(function(t){return t.value})},setValue:function(t,s){var r=e(t),i=r[0],a=r.slice(1);this.selects[0].value=i,this.updateSelect.apply(this,[this.selects[1]].concat(n(a))),s||this.settings.onChange.call(this,this.getValue())},resetValue:function(t){this.selects[0].selectedIndex=0,this.updateSelect(this.selects[1]),t||this.settings.onChange.call(this,this.getValue())},updateSelect:function(t,e){var n=this,s=this.selects.indexOf(t),r=this.selects[s-1].value,i=r&&(!this.settings.placeholder||!this.selects[s-1].options[0].selected);if(this.setStyle(t,i),this.settings.required&&(t.required=i),t.options.length=this.settings.placeholder?1:0,t.selectedIndex=t.options.length-1,i&&this.selectOptions[s-1]){var a=this.settings.dataKeys;this.selectOptions[s-1].some(function(i){if(i[a.value]===r){var o=i[a.children];return n.selectOptions[s]=o,o.forEach(function(e){return t.options.add(new Option(e[a.name],e[a.value]))}),e&&(t.value=e),n.setStyle(t,!!o.length),n.settings.required&&(t.required=!!o.length),!0}return!1})}for(var o=arguments.length,c=Array(o>2?o-2:0),l=2;l<o;l++)c[l-2]=arguments[l];s+1<this.selects.length&&this.updateSelect.apply(this,[this.selects[s+1]].concat(c))},init:function(t){var e=this;if(this.container="string"==typeof this.settings.container?document.querySelector(this.settings.container):this.settings.container,this.selects=Array.prototype.slice.call(this.container.querySelectorAll(this.settings.selector)),this.data=Array.isArray(t)?t:this.convertToArrayData(t),this.selectOptions=[this.data],!this.selects.length){for(var n=document.createDocumentFragment(),s=0,r=this.getDepth(this.data);s<r;s++){var i=document.createElement("select");this.selects.push(i),n.appendChild(i)}this.settings.onRender.call(this,this.selects),this.container.appendChild(n)}if(this.selects.forEach(function(t){t.options.length=0}),this.settings.placeholder){var a=this.settings.placeholder;this.selects.forEach(function(t,e){var n=("string"==typeof a?a:a[e]).split("|");t.options.add(new Option(n[0],n[1],!0,!0)),t.options[0].disabled=!0})}var o=this.selects[0];o.required=this.settings.required,this.data.forEach(function(t){o.options.add(new Option(t[e.settings.dataKeys.name],t[e.settings.dataKeys.value]))}),this.selects.slice(0,this.selects.length-1).forEach(function(t,n){t.addEventListener("change",function(){return e.updateSelect(e.selects[n+1])},!1)}),this.selects.forEach(function(t){t.addEventListener("change",function(){return e.settings.onChange.call(e,e.getValue())},!1)}),this.settings.defaultValue?this.setValue(this.settings.defaultValue,!0):this.selects.slice(1).forEach(function(t){return e.setStyle(t,!1)})}},t.defaults={data:{},dataUrl:null,container:document.body,selector:"select",placeholder:"请选择",defaultValue:null,dataKeys:{name:"name",value:"code",children:"childs"},required:!0,emptyStyle:"disabled",onRender:function(){},onChange:function(){}},t});
